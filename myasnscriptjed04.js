javascript:(async function(){const pendingAsnUrl="https://inbound-api-inbound.noon.team/reports/pending_asn?warehouse_code=W00053710A&format=html";const progressBar=document.createElement('progress');progressBar.max=100;progressBar.value=0;progressBar.style.position='fixed';progressBar.style.top='0';progressBar.style.left='0';progressBar.style.width='100%';progressBar.style.zIndex='1000';document.body.appendChild(progressBar);try{const pendingAsnResponse=await fetch(pendingAsnUrl);if(!pendingAsnResponse.ok){console.error("Error fetching pending ASN data:",pendingAsnResponse.status,pendingAsnResponse.statusText);document.body.removeChild(progressBar);return;}const pendingAsnHtml=await pendingAsnResponse.text();const parser=new DOMParser();const pendingAsnDoc=parser.parseFromString(pendingAsnHtml,'text/html');const asnTable=pendingAsnDoc.querySelector('table');if(!asnTable){console.error("Could not find table in pending asn html");document.body.removeChild(progressBar);return;}const asnRows=asnTable.querySelectorAll('tr');let asnNumbers=[];for(let i=1;i<asnRows.length;i++){const row=asnRows[i];const cells=row.querySelectorAll('td');if(cells.length>0){const asnNumber=cells[0].textContent.trim();asnNumbers.push(asnNumber);}}const urls=asnNumbers.map(asn=>`https://inbound-api-inbound.sc.noon.team/reports/asn_boxes?asn_nr=${asn}&format=html`);const outputDiv=document.createElement('div');document.body.appendChild(outputDiv);const mainHeader=document.createElement('h2');mainHeader.textContent="Combined ASN Data";outputDiv.appendChild(mainHeader);let csvContent="";let allHeaders=[];let headersExtracted=false;const totalUrls=urls.length;for(let i=0;i<totalUrls;i++){const url=urls[i];const response=await fetch(url);if(!response.ok){const errorDiv=document.createElement('div');errorDiv.innerHTML=`<p style="color:red">Error fetching data from URL: ${url} ${response.status} ${response.statusText}</p>`;outputDiv.appendChild(errorDiv);continue;}const html=await response.text();const parser=new DOMParser();const doc=parser.parseFromString(html,'text/html');const table=doc.querySelector("table");if(table){const rows=table.querySelectorAll('tr');if(!headersExtracted){allHeaders=Array.from(rows[0].querySelectorAll("th")).map(th=>th.textContent.trim());csvContent+=allHeaders.join('\t')+'\n';headersExtracted=true;}for(let j=1;j<rows.length;j++){const cells=Array.from(rows[j].querySelectorAll('td'));const rowData=allHeaders.map(header=>{const cell=cells.find(cell=>cell.closest('table').querySelector('th:nth-child('+(cells.indexOf(cell)+1)+')').textContent.trim()===header);return cell?cell.textContent.trim():'';});csvContent+=rowData.join('\t')+'\n';}}const tempDiv=document.createElement('div');tempDiv.innerHTML=`<hr>${html}<hr><br>`;while(tempDiv.firstChild){outputDiv.appendChild(tempDiv.firstChild);}const progress=((i+1)/totalUrls)*100;progressBar.value=progress;}const completionMessage=document.createElement('div');completionMessage.textContent="All ASN data has been fetched and displayed.";completionMessage.style.position='fixed';completionMessage.style.top='0';completionMessage.style.left='0';completionMessage.style.width='100%';completionMessage.style.backgroundColor='#f0f0f0';completionMessage.style.padding='10px';completionMessage.style.textAlign='center';completionMessage.style.zIndex='1001';document.body.replaceChild(completionMessage,progressBar);const csvFile=new Blob([csvContent],{type:"text/tab-separated-values"});const downloadLink=document.createElement("a");downloadLink.href=URL.createObjectURL(csvFile);downloadLink.download="JED04_asn_data.tsv";downloadLink.style.display="none";document.body.appendChild(downloadLink);downloadLink.click();document.body.removeChild(downloadLink);}catch(error){const errorDiv=document.createElement('div');errorDiv.innerHTML=`<p style="color:red">An error occurred: ${error.message}</p>`;document.body.appendChild(errorDiv);document.body.removeChild(progressBar);}})();
